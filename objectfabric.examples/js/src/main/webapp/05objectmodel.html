<html>
<head>
<script src="objectfabric/objectfabric.nocache.js"></script>
</head>
<body>
  <h1>JavaScript - ObjectModel</h1>
  <div id="text">Loading...</div>
  <script>
      function write(s) {
        document.getElementById('text').innerHTML += '<br>' + s;
      }

      // OF for JS supports the same built-in types as other platforms, but
      // currently no custom objects
      function onof(of) {
        var uri = "ws://localhost:8888";

        // Immutables (C.f. Java class Immutable), not all types are
        // supported by gwt-exporter

        of.open(uri + "/string", function(resource) {
          write("/string: " + resource.get());
          write("permission: " + resource.permission());
        });

        of.open(uri + "/int", function(resource) {
          write("/int: " + resource.get());
        });

        // Sets

        of.open(uri + "/set", function(resource) {
          var set = resource.get();

          set.each(function(e) {
            write("/set: " + e);
          });

          // Listen for changes

          set.onadd(function(e) {
            write("/set: added " + e);
          });

          set.onremove(function(e) {
            write("/set: removed " + e);
          });

          // Update

          set.add("e");
          set.remove("e");
        });

        // Maps

        of.open(uri + "/map", function(resource) {
          var map = resource.get();

          map.each(function(key) {
            write("/map: " + key + "=" + map.get(key));
          });

          // Listen for changes

          map.onput(function(key) {
            write("/map: put " + key + "=" + map.get(key));
          });

          map.onremove(function(key) {
            write("/map: removed " + key);
          });

          // Update

          map.put("a", "b");
          map.remove("a");
        });

        // Arrays

        of.open(uri + "/arrayOfInt", function(resource) {
          var array = resource.get();

          write("/array: [0]=" + array.get(0));
          write("/array: [5]=" + array.get(5));
          write("/array: [8]=" + array.get(8));

          // Listen for changes

          array.onset(function(i) {
            write("/array: set " + i + "=" + array.get(i));
          });

          // Update
          array.set(9, 2);
        });

        // Counters

        of.open(uri + "/counter", function(resource) {
          var counter = resource.get();

          write("/counter: " + counter.get());

          // Listen for changes

          // TODO
          // 				counter.onadd(function(delta) {
          // 					write("/array: set " + value);
          // 				});

          // Update
          counter.add(1);
        });
      }
    </script>
</body>
</html>